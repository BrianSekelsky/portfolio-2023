---
import Link from "./Link.astro";
import SmallHeading from "./SmallHeading.astro";
import booksData from "../data/books.json";

const { currentlyReading, read } = booksData;

// Group read books by year
const booksByYear = read.reduce((acc, book) => {
  const year = book.year || 'Unknown';
  if (!acc[year]) acc[year] = [];
  acc[year].push(book);
  return acc;
}, {} as Record<string | number, typeof read>);

// Sort years descending
const sortedYears = Object.keys(booksByYear).sort((a, b) => {
  if (a === 'Unknown') return 1;
  if (b === 'Unknown') return -1;
  return Number(b) - Number(a);
});
---

<div class="site-padding load-in">
  <div class="header-card">
    <!-- Title section -->
    <div class="title-section p-6 sm:p-8">
      <h1
        class="font-serif font-extralight text-4xl sm:text-6xl md:text-7xl leading-[1.1]"
      >
        Reading
      </h1>
    </div>

    <!-- Currently Reading -->
    {currentlyReading.length > 0 && (
      <div class="p-6 sm:p-8 border-t border-[--border-color]">
        <SmallHeading text="Currently Reading" />
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {currentlyReading.map((book) => (
            <div class="book-item flex gap-4">
              {book.coverUrl && (
                <img
                  src={book.coverUrl}
                  alt={`Cover of ${book.title}`}
                  class="w-16 h-24 object-cover rounded shadow-sm flex-shrink-0"
                />
              )}
              <div class="flex flex-col justify-center">
                <div class="font-medium">{book.title}</div>
                <div class="text-sm text-gray">{book.author}</div>
              </div>
            </div>
          ))}
        </div>
      </div>
    )}

    <!-- Read Books by Year -->
    {sortedYears.map((year) => (
      <div class="p-6 sm:p-8 border-t border-[--border-color]">
        <SmallHeading text={`${year}`} />
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {booksByYear[year].map((book) => (
            <div class="book-item flex gap-4">
              {book.coverUrl && (
                <img
                  src={book.coverUrl}
                  alt={`Cover of ${book.title}`}
                  class="w-16 h-24 object-cover rounded shadow-sm flex-shrink-0"
                />
              )}
              <div class="flex flex-col justify-center">
                <div class="font-medium">{book.title}</div>
                <div class="text-sm text-gray">{book.author}</div>
              </div>
            </div>
          ))}
        </div>
      </div>
    ))}

    <!-- Footer link -->
    <div class="p-6 sm:p-8 border-t border-[--border-color] bg-white/50">
      <p class="text-sm text-gray">
        View my full reading history on <Link href="https://app.thestorygraph.com/profile/briansekelsky" name="StoryGraph" />
      </p>
    </div>
  </div>
</div>

<style>
  .title-section {
    /* Match ProjectHeader styling */
  }

  .book-item {
    padding: 0.5rem 0;
  }
</style>
